---
# CPU Stress - Tests CPU resource handling
apiVersion: chaos-mesh.org/v1alpha1
kind: StressChaos
metadata:
  name: cpu-stress-core-service
  namespace: shop
  labels:
    experiment: stress-chaos
    severity: high
spec:
  mode: one
  selector:
    namespaces:
      - shop
    labelSelectors:
      app: core-service
  stressors:
    cpu:
      workers: 2
      load: 80
  duration: "5m"
---
# Memory Stress - Tests memory limits
apiVersion: chaos-mesh.org/v1alpha1
kind: StressChaos
metadata:
  name: memory-stress-oms
  namespace: shop
  labels:
    experiment: stress-chaos
    severity: high
spec:
  mode: one
  selector:
    namespaces:
      - shop
    labelSelectors:
      app: oms-service
  stressors:
    memory:
      workers: 2
      size: "512MB"
  duration: "3m"
---
# Combined CPU and Memory Stress
apiVersion: chaos-mesh.org/v1alpha1
kind: StressChaos
metadata:
  name: combined-stress-crm
  namespace: shop
  labels:
    experiment: stress-chaos
    severity: critical
spec:
  mode: fixed-percent
  value: "50"
  selector:
    namespaces:
      - shop
    labelSelectors:
      app: crm-service
  stressors:
    cpu:
      workers: 1
      load: 60
    memory:
      workers: 1
      size: "256MB"
  duration: "5m"
---
# Scheduled Stress Test
apiVersion: chaos-mesh.org/v1alpha1
kind: Schedule
metadata:
  name: scheduled-stress-test
  namespace: shop
spec:
  schedule: "0 3 * * 6"  # Every Saturday at 3 AM
  type: StressChaos
  stressChaos:
    mode: fixed-percent
    value: "30"
    selector:
      namespaces:
        - shop
      labelSelectors:
        chaos-enabled: "true"
    stressors:
      cpu:
        workers: 1
        load: 70
    duration: "30m"
  concurrencyPolicy: Forbid
